<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibility Audit - Pedro Calado Portfolio</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axe-core/4.8.2/axe.min.js"></script>
    <link rel="stylesheet" href="css/accessibility-test.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Accessibility Audit Report</h1>
            <p><strong>Website:</strong> Pedro Calado Portfolio</p>
            <p><strong>WCAG Level:</strong> 2.1 AA</p>
            <p><strong>Date:</strong> <span id="audit-date"></span></p>
            <div id="compliance-level"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
        </div>

        <div id="loading" class="loading">
            <div>üîÑ Running comprehensive accessibility audit...</div>
            <div style="margin-top: 20px; font-size: 14px; color: #6c757d;">
                This includes automated testing with axe-core and manual WCAG 2.1 AA compliance checks
            </div>
        </div>

        <div id="results" class="hidden">
            <div class="summary" id="summary-metrics"></div>
            
            <div id="automated-results" class="test-section hidden">
                <div class="test-header">
                    <h2>ü§ñ Automated Test Results (axe-core)</h2>
                </div>
                <div class="test-content" id="automated-content"></div>
            </div>

            <div id="manual-results">
                <h2 style="text-align: center; margin: 40px 0; color: #2d7a4e;">üß™ Manual WCAG 2.1 AA Test Results</h2>
            </div>

            <div class="test-section">
                <div class="test-header">
                    <h2>üí° Recommendations & Implementation</h2>
                </div>
                <div class="test-content" id="recommendations"></div>
            </div>

            <div style="text-align: center; margin: 40px 0;">
                <button class="btn btn-primary" onclick="exportReport()">üìÑ Export Report (JSON)</button>
                <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print Report</button>
                <button class="btn btn-primary" onclick="rerunAudit()">üîÑ Rerun Audit</button>
            </div>
        </div>
    </div>

    <script src="accessibility-audit.js"></script>
    <script>
        let auditResults = null;

        async function runAudit() {
            console.log('üöÄ Starting Accessibility Audit...');
            
            // Show loading state
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');

            try {
                // Wait a moment for the page to fully load
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Initialize and run audit
                const audit = new AccessibilityAudit();
                auditResults = await audit.runComprehensiveAudit();

                // Display results
                displayResults(auditResults);

                console.log('‚úÖ Audit completed successfully!');
                console.log('üìä Results:', auditResults);

            } catch (error) {
                console.error('‚ùå Audit failed:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="issue high">
                        <strong>Audit Failed:</strong> ${error.message}
                        <br><br>
                        <button class="btn btn-primary" onclick="rerunAudit()">Try Again</button>
                    </div>
                `;
            }
        }

        function displayResults(results) {
            // Hide loading, show results
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('results').classList.remove('hidden');

            // Set date
            document.getElementById('audit-date').textContent = new Date().toLocaleDateString();

            // Display compliance level
            const compliance = results.summary.wcagCompliance;
            const complianceElement = document.getElementById('compliance-level');
            const complianceClass = `compliance-${compliance.level.toLowerCase().replace('wcag 2.1 ', '').replace(' ', '-')}`;
            complianceElement.innerHTML = `
                <div class="compliance-badge ${complianceClass}">
                    ${compliance.level} - ${compliance.score}% Compliant
                </div>
            `;

            // Animate progress bar
            setTimeout(() => {
                document.getElementById('progress-fill').style.width = `${compliance.score}%`;
            }, 100);

            // Display summary metrics
            displaySummaryMetrics(results.summary);

            // Display automated results
            if (results.automated.violations) {
                displayAutomatedResults(results.automated);
            }

            // Display manual results
            displayManualResults(results.manual);

            // Display recommendations
            displayRecommendations(results.summary.recommendations);
        }

        function displaySummaryMetrics(summary) {
            const metricsContainer = document.getElementById('summary-metrics');
            
            const metrics = [
                {
                    title: 'Total Violations',
                    value: summary.totalViolations,
                    class: summary.totalViolations === 0 ? 'pass' : 'fail'
                },
                {
                    title: 'Critical Issues',
                    value: summary.critical,
                    class: summary.critical === 0 ? 'pass' : 'fail'
                },
                {
                    title: 'Serious Issues',
                    value: summary.serious,
                    class: summary.serious === 0 ? 'pass' : 'fail'
                },
                {
                    title: 'Manual Issues',
                    value: summary.manualIssues,
                    class: summary.manualIssues === 0 ? 'pass' : 'fail'
                },
                {
                    title: 'Tests Passed',
                    value: `${summary.manualPasses}/${summary.manualTests}`,
                    class: summary.manualPasses === summary.manualTests ? 'pass' : 'warning'
                },
                {
                    title: 'Automated Passes',
                    value: summary.passes || 0,
                    class: 'info'
                }
            ];

            metricsContainer.innerHTML = metrics.map(metric => `
                <div class="metric">
                    <h3>${metric.title}</h3>
                    <div class="value ${metric.class}">${metric.value}</div>
                </div>
            `).join('');
        }

        function displayAutomatedResults(automated) {
            if (!automated.violations || automated.violations.length === 0) {
                return;
            }

            const automatedSection = document.getElementById('automated-results');
            automatedSection.classList.remove('hidden');

            const content = document.getElementById('automated-content');
            
            let html = `
                <div class="status-badge status-fail">${automated.violations.length} Violations Found</div>
                <div class="status-badge status-pass">${automated.passes.length} Tests Passed</div>
            `;

            automated.violations.forEach((violation, index) => {
                html += `
                    <div class="issue high">
                        <h4>${violation.impact.toUpperCase()}: ${violation.help}</h4>
                        <p><strong>Rule:</strong> ${violation.id}</p>
                        <p><strong>Description:</strong> ${violation.description}</p>
                        ${violation.nodes.length > 0 ? `
                            <p><strong>Affected Elements:</strong> ${violation.nodes.length} found</p>
                            <details>
                                <summary>View affected elements</summary>
                                ${violation.nodes.map(node => `
                                    <div style="background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 4px; font-family: monospace; font-size: 12px;">
                                        ${node.html ? node.html.substring(0, 200) + '...' : 'Element details'}
                                    </div>
                                `).join('')}
                            </details>
                        ` : ''}
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        function displayManualResults(manual) {
            const container = document.getElementById('manual-results');
            
            Object.entries(manual).forEach(([testName, result]) => {
                const testSection = document.createElement('div');
                testSection.className = 'test-section';
                
                const icon = getTestIcon(testName);
                const displayName = formatTestName(testName);
                
                testSection.innerHTML = `
                    <div class="test-header">
                        <h2>${icon} ${displayName}</h2>
                        <span class="status-badge status-${result.status.toLowerCase()}">${result.status}</span>
                    </div>
                    <div class="test-content">
                        <p><strong>Issues Found:</strong> ${result.total}</p>
                        ${result.total > 0 ? `
                            <h3>Issues:</h3>
                            ${result.issues.map(issue => `
                                <div class="issue">
                                    <strong>${issue.type || 'Issue'}:</strong> ${issue.description || JSON.stringify(issue)}
                                </div>
                            `).join('')}
                        ` : '<p style="color: #28a745;">‚úÖ No issues found!</p>'}
                    </div>
                `;
                
                container.appendChild(testSection);
            });
        }

        function displayRecommendations(recommendations) {
            const container = document.getElementById('recommendations');
            
            if (recommendations.length === 0) {
                container.innerHTML = '<p style="color: #28a745;">‚úÖ No recommendations needed - great accessibility!</p>';
                return;
            }

            container.innerHTML = recommendations.map(rec => `
                <div class="recommendation priority-${rec.priority.toLowerCase()}">
                    <h3>${rec.category} - ${rec.priority} Priority</h3>
                    <p><strong>Issue:</strong> ${rec.issue}</p>
                    <p><strong>Recommendation:</strong> ${rec.recommendation}</p>
                    <p><strong>Implementation:</strong> ${rec.implementation}</p>
                </div>
            `).join('');
        }

        function getTestIcon(testName) {
            const icons = {
                colorContrast: 'üé®',
                keyboardNavigation: '‚å®Ô∏è',
                screenReader: 'üîä',
                focusManagement: 'üéØ',
                aria: '‚ôø',
                semantic: 'üèóÔ∏è',
                responsive: 'üì±',
                reducedMotion: 'üé¨'
            };
            return icons[testName] || 'üß™';
        }

        function formatTestName(testName) {
            const names = {
                colorContrast: 'Color Contrast',
                keyboardNavigation: 'Keyboard Navigation',
                screenReader: 'Screen Reader Compatibility',
                focusManagement: 'Focus Management',
                aria: 'ARIA Implementation',
                semantic: 'Semantic HTML',
                responsive: 'Responsive Design & Zoom',
                reducedMotion: 'Reduced Motion'
            };
            return names[testName] || testName;
        }

        function exportReport() {
            if (!auditResults) {
                alert('No audit results to export. Please run the audit first.');
                return;
            }

            const dataStr = JSON.stringify(auditResults, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportFileDefaultName = `accessibility-audit-${new Date().toISOString().split('T')[0]}.json`;

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function rerunAudit() {
            window.location.reload();
        }

        // Run audit when page loads
        document.addEventListener('DOMContentLoaded', runAudit);
    </script>
</body>
</html>