<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Testing Dashboard</title>
    <link rel="stylesheet" href="css/testing-dashboard.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª Portfolio Testing Dashboard</h1>
            <p>Comprehensive Testing for Pedro Calado's Portfolio Website</p>
        </header>
        
        <main>
            <div class="test-controls">
                <button onclick="runTests()" class="btn">ğŸš€ Run Comprehensive Tests</button>
                <a href="http://localhost:8000" target="_blank" class="btn secondary">ğŸ“± Open Portfolio</a>
            </div>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>ğŸ”§ Core Functionality</h3>
                    <div class="progress-bar">
                        <div id="core-progress" class="progress-fill"></div>
                    </div>
                    <p id="core-status">Ready to test</p>
                </div>
                
                <div class="test-card">
                    <h3>â™¿ Accessibility</h3>
                    <div class="progress-bar">
                        <div id="a11y-progress" class="progress-fill"></div>
                    </div>
                    <p id="a11y-status">Ready to test</p>
                </div>
                
                <div class="test-card">
                    <h3>âš¡ Performance</h3>
                    <div class="progress-bar">
                        <div id="perf-progress" class="progress-fill"></div>
                    </div>
                    <p id="perf-status">Ready to test</p>
                </div>
                
                <div class="test-card">
                    <h3>ğŸ“± Responsive Design</h3>
                    <div class="progress-bar">
                        <div id="resp-progress" class="progress-fill"></div>
                    </div>
                    <p id="resp-status">Ready to test</p>
                </div>
                
                <div class="test-card">
                    <h3>ğŸ™ GitHub Integration</h3>
                    <div class="progress-bar">
                        <div id="github-progress" class="progress-fill"></div>
                    </div>
                    <p id="github-status">Ready to test</p>
                </div>
            </div>
            
            <div class="test-results" id="test-results">
                Click "Run Comprehensive Tests" to start testing the portfolio website.

Test results will appear here, including:
âœ… Passed tests
âš ï¸ Warnings for improvements
âŒ Failed tests that need attention

The tests will cover:
â€¢ Theme toggle functionality
â€¢ Navigation and smooth scrolling
â€¢ Semantic HTML and ARIA compliance
â€¢ Performance metrics and optimization
â€¢ Responsive design across breakpoints
â€¢ GitHub API integration and repository display
â€¢ Micro-interactions and user experience
            </div>
        </main>
    </div>

    <script>
        function runTests() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<div class="loading">Running comprehensive tests</div>';
            
            // Open portfolio in a new window
            const portfolioWindow = window.open('http://localhost:8000', 'portfolio', 'width=1200,height=800');
            
            // Wait for portfolio to load
            portfolioWindow.addEventListener('load', () => {
                // Inject and run the test script
                const testScript = document.createElement('script');
                testScript.textContent = `
                    ${document.querySelector('script[src*=\"browser-test.js\"]').textContent}
                    
                    // Override console.log to capture output
                    const originalLog = console.log;
                    const testOutput = [];
                    
                    console.log = function(...args) {
                        testOutput.push(args.join(' '));
                        originalLog.apply(console, args);
                    };
                    
                    // Run tests and capture results
                    setTimeout(() => {
                        runPortfolioTests();
                        
                        // Send results back to parent window after tests complete
                        setTimeout(() => {
                            window.opener.postMessage({
                                type: 'test-results',
                                output: testOutput.join('\\n')
                            }, '*');
                        }, 8000);
                    }, 1000);
                `;
                
                portfolioWindow.document.body.appendChild(testScript);
                
                // Listen for results
                window.addEventListener('message', (event) => {
                    if (event.data.type === 'test-results') {
                        resultsDiv.innerHTML = event.data.output;
                        updateProgressBars(event.data.output);
                        portfolioWindow.close();
                    }
                });
                
                // Fallback timeout
                setTimeout(() => {
                    if (resultsDiv.innerHTML.includes('Running tests')) {
                        resultsDiv.innerHTML = 'âš ï¸ Test execution timed out. Please check if the portfolio is running at http://localhost:8000';
                        if (portfolioWindow && !portfolioWindow.closed) {
                            portfolioWindow.close();
                        }
                    }
                }, 15000);
            });
            
            // Handle portfolio load failure
            portfolioWindow.addEventListener('error', () => {
                resultsDiv.innerHTML = 'âŒ Failed to load portfolio. Please ensure the local server is running at http://localhost:8000';
            });
        }
        
        function updateProgressBars(output) {
            if (!output) return;
            
            const lines = output.split('\\n');
            const categories = {
                core: { passed: 0, total: 0, element: 'core' },
                a11y: { passed: 0, total: 0, element: 'a11y' },
                perf: { passed: 0, total: 0, element: 'perf' },
                resp: { passed: 0, total: 0, element: 'resp' },
                github: { passed: 0, total: 0, element: 'github' }
            };
            
            lines.forEach(line => {
                if (line.includes('CORE FUNCTIONALITY')) {
                    const matches = line.match(/(âœ…|âŒ|âš ï¸)/g);
                    if (matches) {
                        categories.core.total = matches.length;
                        categories.core.passed = matches.filter(m => m === 'âœ…').length;
                    }
                } else if (line.includes('ACCESSIBILITY')) {
                    const matches = line.match(/(âœ…|âŒ|âš ï¸)/g);
                    if (matches) {
                        categories.a11y.total = matches.length;
                        categories.a11y.passed = matches.filter(m => m === 'âœ…').length;
                    }
                }
                // Similar parsing for other categories...
            });
            
            // Update progress bars
            Object.values(categories).forEach(category => {
                if (category.total > 0) {
                    const percentage = (category.passed / category.total) * 100;
                    const progressEl = document.getElementById(category.element + '-progress');
                    const statusEl = document.getElementById(category.element + '-status');
                    
                    if (progressEl) {
                        progressEl.style.width = percentage + '%';
                    }
                    
                    if (statusEl) {
                        statusEl.textContent = `${category.passed}/${category.total} tests passed (${percentage.toFixed(1)}%)`;
                    }
                }
            });
        }
        
        // Load status message
        fetch('http://localhost:8000')
            .then(response => {
                if (response.ok) {
                    document.getElementById('test-results').innerHTML += '\\n\\nâœ… Portfolio server is running at http://localhost:8000\\nReady to run tests!';
                }
            })
            .catch(() => {
                document.getElementById('test-results').innerHTML += '\\n\\nâš ï¸ Cannot reach portfolio server. Please start the local server with:\\npython -m http.server 8000\\nin the portfolio directory.';
            });
    </script>
</body>
</html>